{"version":3,"file":"index.js","sources":["pages/news/index.nvue","D:/比赛软件/HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbmV3cy9pbmRleC5udnVl"],"sourcesContent":["<template>\n  <view class=\"tabs\">\n    <scroll-view ref=\"tabbar1\" id=\"tab-bar\" class=\"tab-bar\" :scroll=\"false\" :scroll-x=\"true\" :show-scrollbar=\"false\"\n      :scroll-into-view=\"scrollInto\">\n      <view style=\"flex-direction: column;\">\n        <view style=\"flex-direction: row;\">\n          <view class=\"uni-tab-item\" v-for=\"(tab,index) in tabList\" :key=\"tab.id\" :id=\"tab.id\" :ref=\"'tabitem'+index\"\n            :data-id=\"index\" :data-current=\"index\" @click=\"ontabtap\">\n            <text class=\"uni-tab-item-title\" :class=\"tabIndex==index ? 'uni-tab-item-title-active' : ''\">{{tab.name}}</text>\n          </view>\n        </view>\n        <view class=\"scroll-view-indicator\">\n          <view ref=\"underline\" class=\"scroll-view-underline\" :class=\"isTap ? 'scroll-view-animation':''\" :style=\"{left: indicatorLineLeft + 'px', width: indicatorLineWidth + 'px'}\"></view>\n        </view>\n      </view>\n    </scroll-view>\n    <view class=\"tab-bar-line\"></view>\n    <swiper class=\"tab-box\" ref=\"swiper1\" :current=\"tabIndex\" :duration=\"300\" @change=\"onswiperchange\" @transition=\"onswiperscroll\"\n      @animationfinish=\"animationfinish\" @onAnimationEnd=\"animationfinish\">\n      <swiper-item class=\"swiper-item\" v-for=\"(page, index) in tabList\" :key=\"index\">\n        <newsPage class=\"page-item\" :nid=\"page.newsid\" :ref=\"'page' + index\"></newsPage>\n      </swiper-item>\n    </swiper>\n  </view>\n</template>\n\n<script>\n  // #ifdef APP-PLUS\n  const dom = weex.requireModule('dom');\n  // #endif\n\n  import newsPage from './news-page.nvue';\n\n  // 缓存每页最多\n  const MAX_CACHE_DATA = 100;\n  // 缓存页签数量\n  const MAX_CACHE_PAGE = 3;\n  const TAB_PRELOAD_OFFSET = 1;\n\n  export default {\n    components: {\n      newsPage\n    },\n    data() {\n      return {\n        tabList: [{\n          id: \"tab01\",\n          name: '生活用电',\n          newsid: 0\n        }, {\n          id: \"tab02\",\n          name: '电路维修',\n          newsid: 23\n        }, {\n          id: \"tab03\",\n          name: '电器维护',\n          newsid: 223\n        }, {\n          id: \"tab04\",\n          name: '用电改造',\n          newsid: 221\n        }, {\n          id: \"tab05\",\n          name: '故障排除',\n          newsid: 225\n        }, {\n          id: \"tab06\",\n          name: '经典案例',\n          newsid: 208\n        }],\n        tabIndex: 0,\n        cacheTab: [],\n        scrollInto: \"\",\n        navigateFlag: false,\n        indicatorLineLeft: 0,\n        indicatorLineWidth: 0,\n        isTap: false\n      }\n    },\n    onReady() {\n      this._lastTabIndex = 0;\n      this.swiperWidth = 0;\n      this.tabbarWidth = 0;\n      this.tabListSize = {};\n      this._touchTabIndex = 0;\n\n      this.pageList = [];\n      for (var i = 0; i < this.tabList.length; i++) {\n\t\t\t\tlet item = this.$refs['page' + i]\n\t\t\t\tif (Array.isArray(item)) {\n\t\t\t\t\tthis.pageList.push(item[0])\n\t\t\t\t} else {\n\t\t\t\t\tthis.pageList.push(item)\n\t\t\t\t}\n      }\n      this.switchTab(this.tabIndex);\n\n      this.selectorQuery();\n    },\n    methods: {\n      ontabtap(e) {\n        let index = e.target.dataset.current || e.currentTarget.dataset.current;\n        //let offsetIndex = this._touchTabIndex = Math.abs(index - this._lastTabIndex) > 1;\n\n        // #ifdef APP-PLUS || H5 || MP-WEIXIN || MP-QQ\n        this.isTap = true;\n        var currentSize = this.tabListSize[index];\n        this.updateIndicator(currentSize.left, currentSize.width);\n        this._touchTabIndex = index;\n        // #endif\n\n        this.switchTab(index);\n      },\n      onswiperchange(e) {\n        // 注意：百度小程序会触发2次\n\n        // #ifndef APP-PLUS || H5 || MP-WEIXIN || MP-QQ\n        let index = e.target.current || e.detail.current;\n        this.switchTab(index);\n        // #endif\n      },\n      onswiperscroll(e) {\n        if (this.isTap) {\n          return;\n        }\n\n        var offsetX = e.detail.dx;\n        var preloadIndex = this._lastTabIndex;\n        if (offsetX > TAB_PRELOAD_OFFSET) {\n          preloadIndex++;\n        } else if (offsetX < -TAB_PRELOAD_OFFSET) {\n          preloadIndex--;\n        }\n        if (preloadIndex === this._lastTabIndex || preloadIndex < 0 || preloadIndex > this.pageList.length - 1) {\n          return;\n        }\n        if (this.pageList[preloadIndex].dataList.length === 0) {\n          this.loadTabData(preloadIndex);\n        }\n\n        // #ifdef APP-PLUS || H5 || MP-WEIXIN || MP-QQ\n        var percentage = Math.abs(this.swiperWidth / offsetX);\n        var currentSize = this.tabListSize[this._lastTabIndex];\n        var preloadSize = this.tabListSize[preloadIndex];\n        var lineL = currentSize.left + (preloadSize.left - currentSize.left) / percentage;\n        var lineW = currentSize.width + (preloadSize.width - currentSize.width) / percentage;\n        this.updateIndicator(lineL, lineW);\n        // #endif\n      },\n      animationfinish(e) {\n        // #ifdef APP-PLUS || H5 || MP-WEIXIN || MP-QQ\n        let index = e.detail.current;\n        if (this._touchTabIndex === index) {\n          this.isTap = false;\n        }\n        this._lastTabIndex = index;\n        this.switchTab(index);\n        this.updateIndicator(this.tabListSize[index].left, this.tabListSize[index].width);\n        // #endif\n      },\n      selectorQuery() {\n        // #ifdef APP-NVUE\n        dom.getComponentRect(this.$refs.tabbar1, res => {\n          this.tabbarWidth = res.size.width;\n        });\n        dom.getComponentRect(this.$refs['swiper1'], res => {\n          this.swiperWidth = res.size.width;\n        });\n        // for (var i = 0; i < this.tabList.length; i++) {\n        // \tthis.getElementSize(dom, this.$refs['tabitem' + i][0], i);\n        // }\n        // 因 nvue 暂不支持 class 查询\n        var queryTabSize = uni.createSelectorQuery().in(this);\n        for (var i = 0; i < this.tabList.length; i++) {\n          queryTabSize.select('#' + this.tabList[i].id).boundingClientRect();\n        }\n        queryTabSize.exec(rects => {\n          rects.forEach((rect) => {\n            this.tabListSize[rect.dataset.id] = rect;\n          })\n          this.updateIndicator(this.tabListSize[this.tabIndex].left, this.tabListSize[this.tabIndex].width);\n          this.switchTab(this.tabIndex);\n        });\n        // #endif\n\n        // #ifdef MP-WEIXIN || H5 || MP-QQ\n        uni.createSelectorQuery().in(this).select('.tab-box').fields({\n          dataset: true,\n          size: true,\n        }, (res) => {\n          this.swiperWidth = res.width;\n        }).exec();\n        uni.createSelectorQuery().in(this).selectAll('.uni-tab-item').boundingClientRect((rects) => {\n          rects.forEach((rect) => {\n            this.tabListSize[rect.dataset.id] = rect;\n          })\n          this.updateIndicator(this.tabListSize[this.tabIndex].left, this.tabListSize[this.tabIndex].width);\n        }).exec();\n        // #endif\n      },\n      getElementSize(dom, ref, id) {\n        dom.getComponentRect(ref, res => {\n          this.tabListSize[id] = res.size;\n        });\n      },\n      updateIndicator(left, width) {\n        this.indicatorLineLeft = left;\n        this.indicatorLineWidth = width;\n      },\n      switchTab(index) {\n        if (this.pageList[index].dataList.length === 0) {\n          this.loadTabData(index);\n        }\n\n        if (this.tabIndex === index) {\n          return;\n        }\n\n        // 缓存 tabId\n        if (this.pageList[this.tabIndex].dataList.length > MAX_CACHE_DATA) {\n          let isExist = this.cacheTab.indexOf(this.tabIndex);\n          if (isExist < 0) {\n            this.cacheTab.push(this.tabIndex);\n          }\n        }\n\n        this.tabIndex = index;\n\n        // #ifdef APP-NVUE\n        this.scrollTabTo(index);\n        // #endif\n        // #ifndef APP-NVUE\n        this.scrollInto = this.tabList[index].id;\n        // #endif\n\n        // 释放 tabId\n        if (this.cacheTab.length > MAX_CACHE_PAGE) {\n          let cacheIndex = this.cacheTab[0];\n          this.clearTabData(cacheIndex);\n          this.cacheTab.splice(0, 1);\n        }\n      },\n      scrollTabTo(index) {\n        const el = this.$refs['tabitem' + index][0];\n        let offset = 0;\n        // TODO fix ios offset\n        if (index > 0) {\n          offset = this.tabbarWidth / 2 - this.tabListSize[index].width / 2;\n          if (this.tabListSize[index].right < this.tabbarWidth / 2) {\n            offset = this.tabListSize[0].width;\n          }\n        }\n        dom.scrollToElement(el, {\n          offset: -offset\n        });\n      },\n      loadTabData(index) {\n        this.pageList[index].loadData();\n      },\n      clearTabData(index) {\n        this.pageList[index].clear();\n      }\n    }\n  }\n</script>\n\n<style>\n  /* #ifndef APP-PLUS */\n  page {\n    width: 100%;\n    min-height: 100%;\n    display: flex;\n  }\n\n  /* #endif */\n\n  .tabs {\n    flex: 1;\n    flex-direction: column;\n    overflow: hidden;\n    background-color: #ffffff;\n    /* #ifdef MP-ALIPAY || MP-BAIDU */\n    height: 100vh;\n    /* #endif */\n  }\n\n  .tab-bar {\n    /* #ifdef APP-PLUS */\n    width: 750rpx;\n    /* #endif */\n    height: 42px;\n    flex-direction: row;\n    /* #ifndef APP-PLUS */\n    white-space: nowrap;\n    /* #endif */\n  }\n\n  /* #ifndef APP-NVUE */\n  .tab-bar ::-webkit-scrollbar {\n    display: none;\n    width: 0 !important;\n    height: 0 !important;\n    -webkit-appearance: none;\n    background: transparent;\n  }\n\n  /* #endif */\n\n  .scroll-view-indicator {\n    position: relative;\n    height: 2px;\n    background-color: transparent;\n  }\n\n  .scroll-view-underline {\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    width: 0;\n    background-color: #007AFF;\n  }\n\n  .scroll-view-animation {\n    transition-duration: 0.2s;\n    transition-property: left;\n  }\n\n  .tab-bar-line {\n    height: 1px;\n    background-color: #cccccc;\n  }\n\n  .tab-box {\n\t\t/* #ifndef APP-HARMONY */\n\t\tflex: 1;\n\t\t/* #endif */\n\t\t/* #ifdef APP-HARMONY */\n\t\theight: 100vh;\n\t\t/* #endif */\n  }\n\n  .uni-tab-item {\n    /* #ifndef APP-PLUS */\n    display: inline-block;\n    /* #endif */\n    flex-wrap: nowrap;\n    padding-left: 20px;\n    padding-right: 20px;\n  }\n\n  .uni-tab-item-title {\n    color: #555;\n    font-size: 15px;\n    height: 40px;\n    line-height: 40px;\n    flex-wrap: nowrap;\n    /* #ifndef APP-PLUS */\n    white-space: nowrap;\n    /* #endif */\n  }\n\n  .uni-tab-item-title-active {\n    color: #007AFF;\n  }\n\n  .swiper-item {\n    flex: 1;\n    flex-direction: column;\n  }\n\n  .page-item {\n    flex: 1;\n    flex-direction: row;\n    position: absolute;\n    left: 0;\n    top: 0;\n    right: 0;\n    bottom: 0;\n  }\n</style>\n","import MiniProgramPage from 'C:/Users/Administrator/Desktop/xydianan/xydianan/pages/news/index.nvue'\nwx.createPage(MiniProgramPage)"],"names":["uni","dom"],"mappings":"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"}