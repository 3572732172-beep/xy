{"version":3,"file":"detail.js","sources":["pages/news/detail.nvue","D:/比赛软件/HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbmV3cy9kZXRhaWwubnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"content\">\n    <view class=\"banner\" auto-focus>\n      <image class=\"banner-img\" :src=\"banner.image_url\"></image>\n      <view class=\"title-area\">\n        <text class=\"title-text\">{{banner.title}}</text>\n      </view>\n    </view>\n    <view class=\"article-meta\">\n      <text class=\"article-meta-text article-author\">{{banner.source}}</text>\n      <text class=\"article-meta-text article-text\">发表于</text>\n      <text class=\"article-meta-text article-time\">{{banner.datetime}}</text>\n    </view>\n    <view class=\"article-content\">\n      <rich-text :nodes=\"content\" style=\"font-size: 14px;\"></rich-text>\n    </view>\n    <view class=\"comment-wrap\">\n      <view class=\"section-title\">\n        <text class=\"section-title-text\">客户评价</text>\n      </view>\n      <view v-if=\"comments && comments.length\" class=\"comment-list\">\n        <view v-for=\"(item, idx) in comments\" :key=\"idx\" class=\"comment-card\">\n          <view class=\"comment-header\">\n            <text class=\"comment-name\">{{ item.name }}</text>\n            <text class=\"comment-date\">{{ item.date }}</text>\n          </view>\n          <text class=\"comment-content\">{{ item.content }}</text>\n        </view>\n      </view>\n      <view v-else class=\"comment-empty\">\n        <text class=\"comment-empty-text\">暂无评价</text>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\n  import htmlParser from '../../common/html-parser'\n\n  const FAIL_CONTENT = '<p>获取信息失败1</p>';\n\n  function parseImgs(nodes) {\n    nodes.forEach(node => {\n      if (\n        node.name === 'img' &&\n        node.attrs &&\n        node.attrs['data-img-size-val']\n      ) {\n        const sizes = node.attrs['data-img-size-val'].split(',')\n        const width = uni.upx2px(720 * 0.9)\n        const height = parseInt(width * (sizes[1] / sizes[0]))\n        node.attrs.style = `width:${width};height:${height};`\n      }\n      if (Array.isArray(node.children)) {\n        parseImgs(node.children)\n      }\n    })\n    return nodes\n  }\n\n  export default {\n    data() {\n      return {\n        banner: {},\n        content: [],\n        comments: []\n      }\n    },\n    onShareAppMessage() {\n      return {\n        title: this.banner.title || '案例详情',\n        path: '/pages/news/detail?query=' + encodeURIComponent(JSON.stringify(this.banner))\n      }\n    },\n    onLoad(options) {\n      // 小程序平台使用 options.query，App平台可能使用 options.query 或 event.query\n      // 兼容处理不同平台的参数格式\n      let queryParam = options.query || options;\n      \n      // 如果是字符串，直接使用；如果是对象，转为字符串\n      if (typeof queryParam === 'string') {\n        this.load(queryParam);\n      } else if (queryParam && typeof queryParam === 'object') {\n        // 如果已经是对象，直接使用\n        this.banner = queryParam;\n        uni.setNavigationBarTitle({\n          title: this.banner.title || '案例详情'\n        });\n        this.getDetail();\n        this.loadComments();\n      } else {\n        console.error('未获取到有效参数', options);\n        uni.showToast({\n          title: '参数错误',\n          icon: 'none'\n        });\n      }\n    },\n    methods: {\n      load(e) {\n        if (!e) {\n          console.error('参数为空');\n          return;\n        }\n        \n        // 尝试解码参数（可能需要多次解码）\n        let p = e;\n        try {\n          // 第一次解码\n          p = decodeURIComponent(p);\n          // 如果解码后仍然是编码格式，再次解码\n          if (p.includes('%')) {\n            try {\n              p = decodeURIComponent(p);\n            } catch (e2) {\n              // 第二次解码失败，使用第一次解码结果\n            }\n          }\n        } catch (decodeError) {\n          console.error('参数解码失败:', decodeError);\n          // 如果解码失败，尝试直接使用\n          p = e;\n        }\n        \n        try {\n          this.banner = JSON.parse(p);\n        } catch (parseError) {\n          console.error('JSON解析失败:', parseError);\n          console.error('原始参数:', e);\n          console.error('解码后参数:', p);\n          uni.showToast({\n            title: '数据解析失败',\n            icon: 'none'\n          });\n          // 设置默认值，避免页面崩溃\n          this.banner = {\n            title: '加载失败',\n            image_url: '',\n            source: '',\n            datetime: ''\n          };\n        }\n\n        uni.setNavigationBarTitle({\n          title: this.banner.title || '案例详情'\n        });\n\n        this.getDetail();\n        this.loadComments();\n      },\n      getDetail() {\n        // 如果案例数据中已有内容，直接使用\n        if (this.banner.content) {\n          const nodes = htmlParser(this.banner.content);\n          // #ifdef APP-PLUS-NVUE\n          parseImgs(nodes)\n          // #endif\n          this.content = nodes;\n          return;\n        }\n        \n        // 否则根据分类和标题生成内容\n        const content = this.generateCaseContent(this.banner);\n        const nodes = htmlParser(content);\n        // #ifdef APP-PLUS-NVUE\n        parseImgs(nodes)\n        // #endif\n        this.content = nodes;\n      },\n      \n      generateCaseContent(banner) {\n        // 根据标题和分类生成案例详情内容\n        const title = banner.title || '';\n        const master = banner.source || '专业电工';\n        const date = banner.datetime || '';\n        \n        let content = `<h2>${title}</h2>`;\n        content += `<p><strong>施工师傅：</strong>${master}</p>`;\n        content += `<p><strong>案例时间：</strong>${date}</p>`;\n        content += `<hr/>`;\n        \n        // 根据标题关键词生成相应内容\n        if (title.includes('电路改造') || title.includes('用电改造')) {\n          content += `<p>本案例详细记录了${master}为客户进行电路改造的完整过程。</p>`;\n          content += `<h3>一、现场情况</h3>`;\n          content += `<p>客户反映家中电路老化，经常出现跳闸、电压不稳等问题。经过现场检测，发现主要问题包括电路容量不足、电线老化、配电箱配置不合理等。</p>`;\n          content += `<h3>二、改造方案</h3>`;\n          content += `<p>1. 更换全部室内电线，使用国标铜线</p>`;\n          content += `<p>2. 升级配电箱，增加漏电保护器</p>`;\n          content += `<p>3. 重新规划电路布局，合理分配负载</p>`;\n          content += `<p>4. 增加插座数量，满足现代生活需求</p>`;\n          content += `<h3>三、施工过程</h3>`;\n          content += `<p>${master}严格按照国家电气施工规范，确保施工质量和安全。整个改造过程历时3天，期间保持与客户的良好沟通。</p>`;\n          content += `<h3>四、改造效果</h3>`;\n          content += `<p>改造完成后，电路运行稳定，未再出现跳闸现象。客户对改造效果非常满意，称赞${master}专业细致，施工规范。</p>`;\n        } else if (title.includes('维修') || title.includes('故障')) {\n          content += `<p>本案例详细记录了${master}为客户排除电路故障的完整过程。</p>`;\n          content += `<h3>一、故障现象</h3>`;\n          content += `<p>客户反映家中电路出现异常，具体表现为频繁跳闸、电器无法正常工作等。</p>`;\n          content += `<h3>二、故障诊断</h3>`;\n          content += `<p>${master}使用专业工具进行检测，快速定位故障原因。通过系统排查，发现是电路短路/接触不良/过载等问题。</p>`;\n          content += `<h3>三、维修方案</h3>`;\n          content += `<p>根据故障原因，${master}制定了针对性的维修方案，确保彻底解决问题。</p>`;\n          content += `<h3>四、维修效果</h3>`;\n          content += `<p>维修完成后，电路恢复正常，客户对${master}的专业技能和服务态度表示高度认可。</p>`;\n        } else if (title.includes('维护') || title.includes('保养')) {\n          content += `<p>本案例详细记录了${master}为客户进行电器维护的完整过程。</p>`;\n          content += `<h3>一、维护需求</h3>`;\n          content += `<p>客户希望定期对家中电器进行维护保养，延长使用寿命，确保安全运行。</p>`;\n          content += `<h3>二、维护内容</h3>`;\n          content += `<p>${master}对客户家中的电器进行了全面检查，包括电路连接、绝缘性能、接地情况等。</p>`;\n          content += `<h3>三、维护建议</h3>`;\n          content += `<p>${master}向客户提供了专业的维护建议，帮助客户建立正确的用电习惯。</p>`;\n          content += `<h3>四、维护效果</h3>`;\n          content += `<p>经过维护，电器运行更加稳定，客户对${master}的专业服务表示满意。</p>`;\n        } else {\n          content += `<p>本案例详细记录了${master}为客户提供专业电工服务的完整过程。</p>`;\n          content += `<h3>一、客户需求</h3>`;\n          content += `<p>客户遇到了用电相关问题，需要专业电工提供解决方案。</p>`;\n          content += `<h3>二、解决方案</h3>`;\n          content += `<p>${master}根据客户的具体情况，制定了专业的解决方案，确保问题得到彻底解决。</p>`;\n          content += `<h3>三、服务过程</h3>`;\n          content += `<p>${master}严格按照规范操作，确保施工质量和安全，期间与客户保持良好沟通。</p>`;\n          content += `<h3>四、服务效果</h3>`;\n          content += `<p>服务完成后，客户对${master}的专业技能和服务态度表示高度认可，问题得到圆满解决。</p>`;\n        }\n        \n        return content;\n      },\n      \n      /**\n       * 客户评论（示例静态数据，可替换为接口返回）\n       */\n      loadComments() {\n        this.comments = [\n          {\n            name: '王先生',\n            date: '2024-01-18',\n            content: '师傅很专业，沟通顺畅，施工规范，改造后再也没跳闸。'\n          },\n          {\n            name: '李女士',\n            date: '2024-01-12',\n            content: '响应很快，现场检查细致，给了很多安全用电的建议。'\n          },\n          {\n            name: '陈老板',\n            date: '2024-01-05',\n            content: '商铺用电改造一次到位，验收顺利，后续还会合作。'\n          }\n        ];\n      }\n    }\n  }\n</script>\n\n<style>\n  /* #ifndef APP-PLUS */\n  page {\n    min-height: 100%;\n  }\n\n  /* #endif */\n\n  .banner {\n    height: 180px;\n    position: relative;\n    background-color: #ccc;\n    flex-direction: row;\n    overflow: hidden;\n  }\n\n  .banner-img {\n    flex: 1;\n  }\n\n  .title-area {\n    position: absolute;\n    left: 15px;\n    right: 15px;\n    bottom: 15px;\n    z-index: 11;\n  }\n\n  .title-text {\n    font-size: 16px;\n    font-weight: 400;\n    line-height: 20px;\n    lines: 2;\n    color: #ffffff;\n    overflow: hidden;\n  }\n\n  .article-meta {\n    padding: 10px 15px;\n    flex-direction: row;\n    align-items: center;\n    justify-content: flex-start;\n  }\n\n  .article-meta-text {\n    color: gray;\n  }\n\n  .article-text {\n    font-size: 12px;\n    line-height: 25px;\n    margin: 0 10px;\n  }\n\n  .article-author {\n    font-size: 15px;\n  }\n\n  .article-time {\n    font-size: 15px;\n  }\n\n  .article-content {\n    font-size: 15px;\n    padding: 0 15px;\n    margin-bottom: 15px;\n    overflow: hidden;\n  }\n\n  .comment-wrap {\n    margin: 0 15px 30px;\n    padding: 15px;\n    background-color: #f7f9fb;\n    border-radius: 12px;\n  }\n\n  .section-title {\n    margin-bottom: 12px;\n  }\n\n  .section-title-text {\n    font-size: 16px;\n    font-weight: 600;\n    color: #333;\n  }\n\n  .comment-list {\n    gap: 12px;\n  }\n\n  .comment-card {\n    padding: 12px;\n    background: #fff;\n    border-radius: 10px;\n    margin-bottom: 10px;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.04);\n  }\n\n  .comment-header {\n    flex-direction: row;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 6px;\n  }\n\n  .comment-name {\n    font-size: 14px;\n    font-weight: 600;\n    color: #2F85FC;\n  }\n\n  .comment-date {\n    font-size: 12px;\n    color: #999;\n  }\n\n  .comment-content {\n    font-size: 14px;\n    color: #333;\n    line-height: 20px;\n  }\n\n  .comment-empty {\n    padding: 12px 0;\n    align-items: center;\n    justify-content: center;\n  }\n\n  .comment-empty-text {\n    font-size: 14px;\n    color: #999;\n  }\n\n  /* #ifdef H5 */\n\n  .article-content {\n    line-height: 1.8;\n  }\n\n  .article-content img {\n    max-width: 100%;\n  }\n\n  /* #endif */\n</style>\n","import MiniProgramPage from 'C:/Users/Administrator/Desktop/xydianan/xydianan/pages/news/detail.nvue'\nwx.createPage(MiniProgramPage)"],"names":["uni","nodes","htmlParser"],"mappings":";;;;EA6DI,OAAA;AACE,WAAA;AAAA,MACE,QAAA,CAAA;AAAA;;IAGF;AAAA;EAEF,oBAAA;AACE,WAAA;AAAA,MACE,OAAA,KAAA,OAAA,SAAA;AAAA,MACA,MAAA,8BAAA,mBAAA,KAAA,UAAA,KAAA,MAAA,CAAA;AAAA,IACF;AAAA;EAEF,OAAA,SAAA;AAGE,QAAA,aAAA,QAAA,SAAA;AAGA,QAAA,OAAA,eAAA,UAAA;AACE,WAAA,KAAA,UAAA;AAAA;;;QAKE,OAAA,KAAA,OAAA,SAAA;AAAA,MACF,CAAA;AACA,WAAA,UAAA;AACA,WAAA,aAAA;AAAA;AAEAA,oBAAA,MAAA,MAAA,SAAA,gCAAA,YAAA,OAAA;AACAA,oBAAAA,MAAA,UAAA;AAAA;;MAGA,CAAA;AAAA,IACF;AAAA;EAEF,SAAA;AAAA,IACE,KAAA,GAAA;AACE,UAAA,CAAA,GAAA;;AAEE;AAAA,MACF;AAGA,UAAA,IAAA;AACA,UAAA;;AAIE,YAAA,EAAA,SAAA,GAAA,GAAA;AACE,cAAA;;;UAIA;AAAA,QACF;AAAA,MACF,SAAA,aAAA;AACEA,sBAAA,MAAA,MAAA,SAAA,iCAAA,WAAA,WAAA;AAEA,YAAA;AAAA,MACF;AAEA,UAAA;;MAEA,SAAA,YAAA;AACEA,sBAAA,MAAA,MAAA,SAAA,iCAAA,aAAA,UAAA;;;AAGAA,sBAAAA,MAAA,UAAA;AAAA,UACE,OAAA;AAAA;QAEF,CAAA;;;;UAKE,QAAA;AAAA;;MAGJ;;QAGE,OAAA,KAAA,OAAA,SAAA;AAAA,MACF,CAAA;AAEA,WAAA,UAAA;AACA,WAAA,aAAA;AAAA;;;AAKE,cAAAC,SAAAC,kBAAA,UAAA,KAAA,OAAA,OAAA;AAIA,aAAA,UAAAD;AACA;AAAA,MACF;;AAIA,YAAA,QAAAC,4BAAA,OAAA;AAIA,WAAA,UAAA;AAAA;;;AAMA,YAAA,SAAA,OAAA,UAAA;;AAGA,UAAA,UAAA,OAAA,KAAA;;;AAGA,iBAAA;;;;AAME,mBAAA;;AAEA,mBAAA;AACA,mBAAA;AACA,mBAAA;AACA,mBAAA;;AAEA,mBAAA,MAAA,MAAA;;AAEA,mBAAA,0CAAA,MAAA;AAAA;;;;;AAMA,mBAAA,MAAA,MAAA;;;;;;;;;;;;;;;;;;AAkBA,mBAAA;;;;;;AAMA,mBAAA,eAAA,MAAA;AAAA,MACF;;;;;;IAQF,eAAA;AACE,WAAA,WAAA;AAAA,QACE;AAAA;UAEE,MAAA;AAAA,UACA,SAAA;AAAA;QAEF;AAAA;UAEE,MAAA;AAAA,UACA,SAAA;AAAA;QAEF;AAAA;UAEE,MAAA;AAAA,UACA,SAAA;AAAA,QACF;AAAA;IAEJ;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;AC5PF,GAAG,WAAW,eAAe;"}