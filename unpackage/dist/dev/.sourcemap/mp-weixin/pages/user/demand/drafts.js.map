{"version":3,"file":"drafts.js","sources":["pages/user/demand/drafts.vue","D:/比赛软件/HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci9kZW1hbmQvZHJhZnRzLnZ1ZQ"],"sourcesContent":["<template>\n\t<view class=\"container\" :class=\"{ 'large-font': largeFontMode }\">\n\t\t<view class=\"draft-list\">\n\t\t\t<view \n\t\t\t\tclass=\"draft-item\" \n\t\t\t\tv-for=\"draft in draftList\" \n\t\t\t\t:key=\"draft.offline_local_id\"\n\t\t\t\t@click=\"editDraft(draft)\"\n\t\t\t>\n\t\t\t\t<view class=\"draft-header\">\n\t\t\t\t\t<text class=\"draft-title\">{{ draft.title || '未命名需求' }}</text>\n\t\t\t\t\t<text class=\"draft-time\">{{ formatTime(draft.updated_at) }}</text>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"draft-info\">\n\t\t\t\t\t<text class=\"draft-scene\">{{ getSceneText(draft.service_type) }}</text>\n\t\t\t\t\t<text class=\"draft-address\" v-if=\"draft.address\">{{ draft.address }}</text>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"draft-actions\">\n\t\t\t\t\t<button class=\"btn btn-small\" @click.stop=\"deleteDraft(draft)\">删除</button>\n\t\t\t\t\t<button class=\"btn btn-small btn-primary\" @click.stop=\"editDraft(draft)\">编辑</button>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<view class=\"empty\" v-if=\"draftList.length === 0\">\n\t\t\t<text>暂无草稿</text>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\nimport offline from '@/utils/offline.js';\nimport userStore from '@/store/user.js';\n\nexport default {\n\tdata() {\n\t\treturn {\n\t\t\tdraftList: [],\n\t\t\tlargeFontMode: false\n\t\t};\n\t},\n\tonLoad() {\n\t\tthis.largeFontMode = userStore.state.largeFontMode;\n\t\tthis.loadDrafts();\n\t},\n\tonShow() {\n\t\t// 每次显示时刷新列表\n\t\tthis.loadDrafts();\n\t},\n\tmethods: {\n\t\t/**\n\t\t * 加载草稿列表\n\t\t */\n\t\tloadDrafts() {\n\t\t\tthis.draftList = offline.draftDemand.getAll();\n\t\t},\n\t\t\n\t\t/**\n\t\t * 获取场景文本\n\t\t */\n\t\tgetSceneText(sceneType) {\n\t\t\tconst sceneMap = {\n\t\t\t\t1: '生活用电',\n\t\t\t\t2: '养殖棚',\n\t\t\t\t3: '加工配套',\n\t\t\t\t4: '其他'\n\t\t\t};\n\t\t\treturn sceneMap[sceneType] || '未知';\n\t\t},\n\t\t\n\t\t/**\n\t\t * 格式化时间\n\t\t */\n\t\tformatTime(timestamp) {\n\t\t\tif (!timestamp) return '';\n\t\t\tconst date = new Date(timestamp);\n\t\t\tconst year = date.getFullYear();\n\t\t\tconst month = String(date.getMonth() + 1).padStart(2, '0');\n\t\t\tconst day = String(date.getDate()).padStart(2, '0');\n\t\t\tconst hour = String(date.getHours()).padStart(2, '0');\n\t\t\tconst minute = String(date.getMinutes()).padStart(2, '0');\n\t\t\treturn `${year}-${month}-${day} ${hour}:${minute}`;\n\t\t},\n\t\t\n\t\t/**\n\t\t * 编辑草稿\n\t\t */\n\t\teditDraft(draft) {\n\t\t\tuni.navigateTo({\n\t\t\t\turl: `/pages/user/demand/create?draftId=${draft.offline_local_id}`\n\t\t\t});\n\t\t},\n\t\t\n\t\t/**\n\t\t * 删除草稿\n\t\t */\n\t\tdeleteDraft(draft) {\n\t\t\tuni.showModal({\n\t\t\t\ttitle: '确认删除',\n\t\t\t\tcontent: '确定要删除此草稿吗？',\n\t\t\t\tsuccess: (res) => {\n\t\t\t\t\tif (res.confirm) {\n\t\t\t\t\t\toffline.draftDemand.remove(draft.offline_local_id);\n\t\t\t\t\t\toffline.syncQueue.remove(draft.offline_local_id);\n\t\t\t\t\t\tthis.loadDrafts();\n\t\t\t\t\t\t\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: '已删除',\n\t\t\t\t\t\t\ticon: 'success'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n};\n</script>\n\n<style scoped>\n.container {\n\tbackground-color: #f5f5f5;\n\tmin-height: 100vh;\n\tpadding: 20rpx;\n}\n\n.draft-list {\n\t\n}\n\n.draft-item {\n\tbackground-color: #fff;\n\tborder-radius: 12rpx;\n\tpadding: 30rpx;\n\tmargin-bottom: 20rpx;\n}\n\n.draft-header {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tmargin-bottom: 15rpx;\n}\n\n.draft-title {\n\tfont-size: 32rpx;\n\tfont-weight: bold;\n\tcolor: #333;\n\tflex: 1;\n}\n\n.draft-time {\n\tfont-size: 24rpx;\n\tcolor: #999;\n}\n\n.draft-info {\n\tmargin-bottom: 20rpx;\n}\n\n.draft-scene {\n\tfont-size: 28rpx;\n\tcolor: #2F85FC;\n\tmargin-right: 20rpx;\n}\n\n.draft-address {\n\tfont-size: 28rpx;\n\tcolor: #666;\n}\n\n.draft-actions {\n\tdisplay: flex;\n\tgap: 20rpx;\n\tjustify-content: flex-end;\n}\n\n.btn-small {\n\tpadding: 10rpx 30rpx;\n\tfont-size: 28rpx;\n\tborder-radius: 8rpx;\n\tborder: 2rpx solid #e0e0e0;\n\tbackground-color: #fff;\n\tcolor: #666;\n}\n\n.btn-small.btn-primary {\n\tbackground-color: #2F85FC;\n\tcolor: #fff;\n\tborder-color: #2F85FC;\n}\n\n.empty {\n\ttext-align: center;\n\tpadding: 100rpx 0;\n\tfont-size: 28rpx;\n\tcolor: #999;\n}\n</style>\n\n","import MiniProgramPage from 'C:/Users/Administrator/Desktop/xydianan/xydianan/pages/user/demand/drafts.vue'\nwx.createPage(MiniProgramPage)"],"names":["userStore","offline","uni"],"mappings":";;;;AAkCA,MAAK,YAAU;AAAA,EACd,OAAO;AACN,WAAO;AAAA,MACN,WAAW,CAAE;AAAA,MACb,eAAe;AAAA;EAEhB;AAAA,EACD,SAAS;AACR,SAAK,gBAAgBA,qBAAU,MAAM;AACrC,SAAK,WAAU;AAAA,EACf;AAAA,EACD,SAAS;AAER,SAAK,WAAU;AAAA,EACf;AAAA,EACD,SAAS;AAAA;AAAA;AAAA;AAAA,IAIR,aAAa;AACZ,WAAK,YAAYC,cAAAA,QAAQ,YAAY,OAAM;AAAA,IAC3C;AAAA;AAAA;AAAA;AAAA,IAKD,aAAa,WAAW;AACvB,YAAM,WAAW;AAAA,QAChB,GAAG;AAAA,QACH,GAAG;AAAA,QACH,GAAG;AAAA,QACH,GAAG;AAAA;AAEJ,aAAO,SAAS,SAAS,KAAK;AAAA,IAC9B;AAAA;AAAA;AAAA;AAAA,IAKD,WAAW,WAAW;AACrB,UAAI,CAAC;AAAW,eAAO;AACvB,YAAM,OAAO,IAAI,KAAK,SAAS;AAC/B,YAAM,OAAO,KAAK;AAClB,YAAM,QAAQ,OAAO,KAAK,SAAQ,IAAK,CAAC,EAAE,SAAS,GAAG,GAAG;AACzD,YAAM,MAAM,OAAO,KAAK,QAAS,CAAA,EAAE,SAAS,GAAG,GAAG;AAClD,YAAM,OAAO,OAAO,KAAK,SAAU,CAAA,EAAE,SAAS,GAAG,GAAG;AACpD,YAAM,SAAS,OAAO,KAAK,WAAY,CAAA,EAAE,SAAS,GAAG,GAAG;AACxD,aAAO,GAAG,IAAI,IAAI,KAAK,IAAI,GAAG,IAAI,IAAI,IAAI,MAAM;AAAA,IAChD;AAAA;AAAA;AAAA;AAAA,IAKD,UAAU,OAAO;AAChBC,oBAAAA,MAAI,WAAW;AAAA,QACd,KAAK,qCAAqC,MAAM,gBAAgB;AAAA,MACjE,CAAC;AAAA,IACD;AAAA;AAAA;AAAA;AAAA,IAKD,YAAY,OAAO;AAClBA,oBAAAA,MAAI,UAAU;AAAA,QACb,OAAO;AAAA,QACP,SAAS;AAAA,QACT,SAAS,CAAC,QAAQ;AACjB,cAAI,IAAI,SAAS;AAChBD,0BAAAA,QAAQ,YAAY,OAAO,MAAM,gBAAgB;AACjDA,0BAAAA,QAAQ,UAAU,OAAO,MAAM,gBAAgB;AAC/C,iBAAK,WAAU;AAEfC,0BAAAA,MAAI,UAAU;AAAA,cACb,OAAO;AAAA,cACP,MAAM;AAAA,YACP,CAAC;AAAA,UACF;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AAAA,EACD;AACD;;;;;;;;;;;;;;;;;;;;;;;;AClHA,GAAG,WAAW,eAAe;"}