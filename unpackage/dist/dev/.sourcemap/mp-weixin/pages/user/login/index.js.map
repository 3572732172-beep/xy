{"version":3,"file":"index.js","sources":["pages/user/login/index.vue","D:/比赛软件/HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci9sb2dpbi9pbmRleC52dWU"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<image class=\"bg-image\" src=\"/static/bgc.png\" mode=\"aspectFill\" />\n\t\t<view class=\"overlay\"></view>\n\t\t<page-header\n\t\t\ttitle=\"欢迎回到乡野电安\"\n\t\t\tsubtitle=\"一键登录，发布用电改造需求\"\n\t\t\t:showBack=\"true\"\n\t\t/>\n\t\t\n\t\t<view class=\"login-header\">\n\t\t\t<image class=\"logo\" src=\"/static/logo.png\" mode=\"aspectFit\" />\n\t\t\t<text class=\"app-name\">乡野电安</text>\n\t\t\t<text class=\"app-desc\">需求端（用户版）</text>\n\t\t</view>\n\t\t\n\t\t<view class=\"login-form\">\n\t\t\t<view class=\"wechat-tip\">\n\t\t\t\t<text class=\"tip-title\">微信一键登录</text>\n\t\t\t\t<text class=\"tip-desc\">无需记密码，授权后即可安全使用</text>\n\t\t\t</view>\n\t\t\t\n\t\t\t<button \n\t\t\t\tclass=\"btn btn-primary\" \n\t\t\t\t:loading=\"submitting\"\n\t\t\t\t@click=\"handleWechatLogin\"\n\t\t\t>\n\t\t\t\t{{ submitting ? '登录中...' : '使用微信登录' }}\n\t\t\t</button>\n\t\t</view>\n\t\t\n\t\t<view class=\"login-footer\">\n\t\t\t<text class=\"footer-text\">登录即表示同意《用户协议》和《隐私政策》</text>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\nimport userStore from '@/store/user.js';\nimport PageHeader from '@/components/PageHeader.vue';\n\nexport default {\n\tcomponents: {\n\t\tPageHeader\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tsubmitting: false\n\t\t};\n\t},\n\tonLoad() {\n\t\tif (userStore.state.isLoggedIn) {\n\t\t\tuni.switchTab({\n\t\t\t\turl: '/pages/index/index'\n\t\t\t});\n\t\t}\n\t},\n\tmethods: {\n\t\t/**\n\t\t * 微信登录\n\t\t */\n\t\tasync handleWechatLogin() {\n\t\t\tthis.submitting = true;\n\t\t\ttry {\n\t\t\t\t// 尝试调用后端登录接口\n\t\t\t\tlet userInfo = null;\n\t\t\t\tlet token = null;\n\t\t\t\t\n\t\t\t\ttry {\n\t\t\t\t\t// 获取微信登录code（小程序环境）\n\t\t\t\t\t// #ifdef MP-WEIXIN\n\t\t\t\t\tconst loginRes = await new Promise((resolve, reject) => {\n\t\t\t\t\t\tuni.login({\n\t\t\t\t\t\t\tprovider: 'weixin',\n\t\t\t\t\t\t\tsuccess: resolve,\n\t\t\t\t\t\t\tfail: reject\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tif (loginRes.code) {\n\t\t\t\t\t\tconst result = await uni.request({\n\t\t\t\t\t\t\turl: 'http://192.168.109.1:3000/api/auth/wechat-login',\n\t\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tcode: loginRes.code,\n\t\t\t\t\t\t\t\tnickName: '微信用户',\n\t\t\t\t\t\t\t\tavatarUrl: ''\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (result.data && result.data.code === 0) {\n\t\t\t\t\t\t\tuserInfo = {\n\t\t\t\t\t\t\t\tid: result.data.data.id,\n\t\t\t\t\t\t\t\tphone: result.data.data.phone,\n\t\t\t\t\t\t\t\tname: result.data.data.name || '微信用户',\n\t\t\t\t\t\t\t\tavatar: result.data.data.avatar || ''\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\ttoken = result.data.data.token;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// #endif\n\t\t\t\t\t\n\t\t\t\t\t// 如果微信登录失败，使用临时账号\n\t\t\t\t\tif (!userInfo || !token) {\n\t\t\t\t\t\tthrow new Error('微信登录失败，使用临时账号');\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.log('使用临时账号登录', error);\n\t\t\t\t\t// 临时模拟登录\n\t\t\t\t\tuserInfo = {\n\t\t\t\t\t\tid: 1,\n\t\t\t\t\t\tphone: '13800138000',\n\t\t\t\t\t\tname: '测试用户',\n\t\t\t\t\t\tavatar: ''\n\t\t\t\t\t};\n\t\t\t\t\ttoken = 'dev-token-' + Date.now();\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// 保存登录信息\n\t\t\t\tuserStore.setUserInfo(userInfo, token);\n\t\t\t\t\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '登录成功',\n\t\t\t\t\ticon: 'success'\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tuni.switchTab({\n\t\t\t\t\t\turl: '/pages/index/index'\n\t\t\t\t\t});\n\t\t\t\t}, 800);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('登录失败', error);\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '登录失败，请重试',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t});\n\t\t\t} finally {\n\t\t\t\tthis.submitting = false;\n\t\t\t}\n\t\t}\n\t}\n};\n</script>\n\n<style scoped>\n.container {\n\tmin-height: 100vh;\n\tpadding: 40rpx 32rpx 60rpx;\n\tdisplay: flex;\n\tflex-direction: column;\n\tjustify-content: flex-start;\n\tposition: relative;\n}\n\n.bg-image {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\twidth: 100%;\n\theight: 100%;\n\tz-index: 0;\n}\n\n.overlay {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tbackground: linear-gradient(180deg, rgba(0, 0, 0, 0.15), rgba(0, 0, 0, 0.45));\n\tz-index: 0;\n}\n\n.login-header {\n\ttext-align: center;\n\tmargin: 80rpx 0 60rpx;\n\tz-index: 1;\n}\n\n.logo {\n\twidth: 120rpx;\n\theight: 120rpx;\n\tmargin-bottom: 30rpx;\n\tborder-radius: 24rpx;\n\tbackground-color: rgba(255, 255, 255, 0.8);\n\tpadding: 20rpx;\n}\n\n.app-name {\n\tdisplay: block;\n\tfont-size: 48rpx;\n\tfont-weight: bold;\n\tcolor: #e6fffa;\n\tmargin-bottom: 10rpx;\n}\n\n.app-desc {\n\tdisplay: block;\n\tfont-size: 28rpx;\n\tcolor: rgba(230, 255, 250, 0.9);\n}\n\n.login-form {\n\tbackground-color: rgba(255, 255, 255, 0.95);\n\tborder-radius: 24rpx;\n\tpadding: 50rpx 40rpx;\n\tbox-shadow: 0 10rpx 40rpx rgba(0, 0, 0, 0.1);\n\tz-index: 1;\n}\n\n.wechat-tip {\n\tmargin-bottom: 40rpx;\n}\n\n.tip-title {\n\tfont-size: 34rpx;\n\tfont-weight: bold;\n\tcolor: #22543d;\n\tmargin-bottom: 10rpx;\n}\n\n.tip-desc {\n\tfont-size: 26rpx;\n\tcolor: #5f8c6a;\n}\n\n.btn {\n\twidth: 100%;\n\theight: 88rpx;\n\tline-height: 88rpx;\n\ttext-align: center;\n\tborder-radius: 12rpx;\n\tfont-size: 32rpx;\n\tfont-weight: bold;\n\tborder: none;\n\tmargin-top: 20rpx;\n}\n\n.btn-primary {\n\tbackground: linear-gradient(135deg, #38a169 0%, #2f855a 100%);\n\tcolor: #fff;\n\tbox-shadow: 0 8rpx 20rpx rgba(56, 161, 105, 0.35);\n}\n\n.login-footer {\n\ttext-align: center;\n\tmargin-top: 40rpx;\n\tz-index: 1;\n}\n\n.footer-text {\n\tfont-size: 24rpx;\n\tcolor: rgba(230, 255, 250, 0.85);\n}\n</style>\n\n","import MiniProgramPage from 'C:/Users/Administrator/Desktop/xydianan/xydianan/pages/user/login/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["userStore","uni"],"mappings":";;;;AAuCA,mBAAmB,MAAW;AAE9B,MAAK,YAAU;AAAA,EACd,YAAY;AAAA,IACX;AAAA,EACA;AAAA,EACD,OAAO;AACN,WAAO;AAAA,MACN,YAAY;AAAA;EAEb;AAAA,EACD,SAAS;AACR,QAAIA,WAAS,UAAC,MAAM,YAAY;AAC/BC,oBAAAA,MAAI,UAAU;AAAA,QACb,KAAK;AAAA,MACN,CAAC;AAAA,IACF;AAAA,EACA;AAAA,EACD,SAAS;AAAA;AAAA;AAAA;AAAA,IAIR,MAAM,oBAAoB;AACzB,WAAK,aAAa;AAClB,UAAI;AAEH,YAAI,WAAW;AACf,YAAI,QAAQ;AAEZ,YAAI;AAGH,gBAAM,WAAW,MAAM,IAAI,QAAQ,CAAC,SAAS,WAAW;AACvDA,0BAAAA,MAAI,MAAM;AAAA,cACT,UAAU;AAAA,cACV,SAAS;AAAA,cACT,MAAM;AAAA,YACP,CAAC;AAAA,UACF,CAAC;AAED,cAAI,SAAS,MAAM;AAClB,kBAAM,SAAS,MAAMA,cAAG,MAAC,QAAQ;AAAA,cAChC,KAAK;AAAA,cACL,QAAQ;AAAA,cACR,MAAM;AAAA,gBACL,MAAM,SAAS;AAAA,gBACf,UAAU;AAAA,gBACV,WAAW;AAAA,cACZ;AAAA,YACD,CAAC;AAED,gBAAI,OAAO,QAAQ,OAAO,KAAK,SAAS,GAAG;AAC1C,yBAAW;AAAA,gBACV,IAAI,OAAO,KAAK,KAAK;AAAA,gBACrB,OAAO,OAAO,KAAK,KAAK;AAAA,gBACxB,MAAM,OAAO,KAAK,KAAK,QAAQ;AAAA,gBAC/B,QAAQ,OAAO,KAAK,KAAK,UAAU;AAAA;AAEpC,sBAAQ,OAAO,KAAK,KAAK;AAAA,YAC1B;AAAA,UACD;AAIA,cAAI,CAAC,YAAY,CAAC,OAAO;AACxB,kBAAM,IAAI,MAAM,eAAe;AAAA,UAChC;AAAA,QACC,SAAO,OAAO;AACfA,gFAAY,YAAY,KAAK;AAE7B,qBAAW;AAAA,YACV,IAAI;AAAA,YACJ,OAAO;AAAA,YACP,MAAM;AAAA,YACN,QAAQ;AAAA;AAET,kBAAQ,eAAe,KAAK;QAC7B;AAGAD,mBAAAA,UAAU,YAAY,UAAU,KAAK;AAErCC,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QACP,CAAC;AAED,mBAAW,MAAM;AAChBA,wBAAAA,MAAI,UAAU;AAAA,YACb,KAAK;AAAA,UACN,CAAC;AAAA,QACD,GAAE,GAAG;AAAA,MACL,SAAO,OAAO;AACfA,gFAAc,QAAQ,KAAK;AAC3BA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,QACP,CAAC;AAAA,MACF,UAAU;AACT,aAAK,aAAa;AAAA,MACnB;AAAA,IACD;AAAA,EACD;AACD;;;;;;;;;;;;;;;;;;;;AC7IA,GAAG,WAAW,eAAe;"}