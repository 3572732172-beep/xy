{"version":3,"file":"user.js","sources":["store/user.js"],"sourcesContent":["/**\r\n * 用户状态管理（使用 Vuex 风格，兼容 Vue2/Vue3）\r\n * 管理用户信息、token、全局设置（大字体模式等）\r\n */\r\n\r\n// 简单的状态管理实现（如果项目没有 Vuex/Pinia，可以用这个）\r\nclass UserStore {\r\n\tconstructor() {\r\n\t\tthis.state = {\r\n\t\t\t// 用户信息\r\n\t\t\tuserInfo: null,\r\n\t\t\ttoken: '',\r\n\t\t\tisLoggedIn: false,\r\n\t\t\t\r\n\t\t\t// 全局设置\r\n\t\t\tlargeFontMode: false, // 大字体模式\r\n\t\t\tfontSize: 14, // 基础字体大小（rpx）\r\n\t\t\t\r\n\t\t\t// 定位信息\r\n\t\t\tlocation: {\r\n\t\t\t\tlng: null,\r\n\t\t\t\tlat: null,\r\n\t\t\t\taddress: ''\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\t// 从本地存储恢复\r\n\t\tthis.loadFromStorage();\r\n\t}\r\n\t\r\n\t/**\r\n\t * 从本地存储加载\r\n\t */\r\n\tloadFromStorage() {\r\n\t\ttry {\r\n\t\t\tconst token = uni.getStorageSync('token');\r\n\t\t\tconst userInfo = uni.getStorageSync('userInfo');\r\n\t\t\tconst largeFontMode = uni.getStorageSync('largeFontMode') || false;\r\n\t\t\tconst fontSize = uni.getStorageSync('fontSize') || 14;\r\n\t\t\t\r\n\t\t\t// 如果token和userInfo都存在，恢复登录状态\r\n\t\t\tif (token && userInfo) {\r\n\t\t\t\tthis.state.token = token;\r\n\t\t\t\tthis.state.userInfo = userInfo;\r\n\t\t\t\tthis.state.isLoggedIn = true;\r\n\t\t\t\tconsole.log('已恢复登录状态，用户ID:', userInfo.id);\r\n\t\t\t} else {\r\n\t\t\t\t// 如果只有token没有userInfo，清除token\r\n\t\t\t\tif (token && !userInfo) {\r\n\t\t\t\t\tuni.removeStorageSync('token');\r\n\t\t\t\t\tthis.state.token = '';\r\n\t\t\t\t\tthis.state.isLoggedIn = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.state.largeFontMode = largeFontMode;\r\n\t\t\tthis.state.fontSize = fontSize;\r\n\t\t\t\r\n\t\t\t// 应用字体设置\r\n\t\t\tthis.applyFontSize();\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error('加载本地存储失败', e);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * 保存到本地存储\r\n\t */\r\n\tsaveToStorage() {\r\n\t\ttry {\r\n\t\t\tif (this.state.token) {\r\n\t\t\t\tuni.setStorageSync('token', this.state.token);\r\n\t\t\t}\r\n\t\t\tif (this.state.userInfo) {\r\n\t\t\t\tuni.setStorageSync('userInfo', this.state.userInfo);\r\n\t\t\t}\r\n\t\t\tuni.setStorageSync('largeFontMode', this.state.largeFontMode);\r\n\t\t\tuni.setStorageSync('fontSize', this.state.fontSize);\r\n\t\t} catch (e) {\r\n\t\t\tconsole.error('保存本地存储失败', e);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * 设置用户信息\r\n\t */\r\n\tsetUserInfo(userInfo, token) {\r\n\t\tthis.state.userInfo = userInfo;\r\n\t\tthis.state.token = token;\r\n\t\tthis.state.isLoggedIn = !!token;\r\n\t\t// 立即保存到本地存储，确保持久化\r\n\t\tuni.setStorageSync('token', token);\r\n\t\tuni.setStorageSync('userInfo', userInfo);\r\n\t\tthis.saveToStorage();\r\n\t\tconsole.log('用户登录成功，已保存登录状态，用户ID:', userInfo.id);\r\n\t}\r\n\t\r\n\t/**\r\n\t * 清除用户信息（退出登录）\r\n\t */\r\n\tclearUserInfo() {\r\n\t\tthis.state.userInfo = null;\r\n\t\tthis.state.token = '';\r\n\t\tthis.state.isLoggedIn = false;\r\n\t\tuni.removeStorageSync('token');\r\n\t\tuni.removeStorageSync('userInfo');\r\n\t}\r\n\t\r\n\t/**\r\n\t * 切换大字体模式\r\n\t */\r\n\ttoggleLargeFontMode() {\r\n\t\tthis.state.largeFontMode = !this.state.largeFontMode;\r\n\t\tthis.state.fontSize = this.state.largeFontMode ? 18 : 14;\r\n\t\tthis.saveToStorage();\r\n\t\tthis.applyFontSize();\r\n\t}\r\n\t\r\n\t/**\r\n\t * 设置字体大小\r\n\t */\r\n\tsetFontSize(size) {\r\n\t\tthis.state.fontSize = size;\r\n\t\tthis.state.largeFontMode = size >= 18;\r\n\t\tthis.saveToStorage();\r\n\t\tthis.applyFontSize();\r\n\t}\r\n\t\r\n\t/**\r\n\t * 应用字体大小到全局\r\n\t */\r\n\tapplyFontSize() {\r\n\t\t// 通过设置全局 CSS 变量或直接操作页面根元素\r\n\t\t// 注意：uni-app 中可以通过设置页面根元素的 font-size 来实现\r\n\t\t// 这里需要在 App.vue 或页面中动态应用\r\n\t}\r\n\t\r\n\t/**\r\n\t * 设置定位信息\r\n\t */\r\n\tsetLocation(lng, lat, address = '') {\r\n\t\tthis.state.location = {\r\n\t\t\tlng,\r\n\t\t\tlat,\r\n\t\t\taddress\r\n\t\t};\r\n\t}\r\n\t\r\n\t/**\r\n\t * 获取定位信息\r\n\t */\r\n\tgetLocation() {\r\n\t\treturn this.state.location;\r\n\t}\r\n}\r\n\r\n// 创建单例\r\nconst userStore = new UserStore();\r\n\r\nexport default userStore;\r\n\r\n\r\n"],"names":["uni"],"mappings":"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"}