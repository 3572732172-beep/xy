{"version":3,"file":"upload.js","sources":["utils/upload.js"],"sourcesContent":["/**\r\n * 图片上传工具\r\n * 支持上传到服务器并返回URL\r\n */\r\n\r\nimport request, { BASE_URL } from './request.js';\r\n\r\n/**\r\n * 上传单张图片\r\n * @param {String} filePath 本地文件路径\r\n * @returns {Promise<String>} 图片URL\r\n */\r\nfunction uploadImage(filePath) {\r\n  return new Promise((resolve, reject) => {\r\n    uni.uploadFile({\r\n      url: BASE_URL + '/api/upload/image',\r\n      filePath: filePath,\r\n      name: 'file',\r\n      header: {\r\n        'Authorization': 'Bearer ' + (uni.getStorageSync('token') || '')\r\n      },\r\n      success: (res) => {\r\n        try {\r\n          const data = JSON.parse(res.data);\r\n          if (data.code === 0) {\r\n            resolve(data.data.url);\r\n          } else {\r\n            reject(new Error(data.msg || '上传失败'));\r\n          }\r\n        } catch (e) {\r\n          reject(new Error('解析响应失败'));\r\n        }\r\n      },\r\n      fail: (err) => {\r\n        reject(err);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * 批量上传图片\r\n * @param {Array<String>} filePaths 本地文件路径数组\r\n * @returns {Promise<Array<String>>} 图片URL数组\r\n */\r\nasync function uploadImages(filePaths) {\r\n  const uploadPromises = filePaths.map(path => uploadImage(path));\r\n  try {\r\n    const urls = await Promise.all(uploadPromises);\r\n    return urls;\r\n  } catch (error) {\r\n    console.error('批量上传失败', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\nexport default {\r\n  uploadImage,\r\n  uploadImages\r\n};\r\n\r\n"],"names":["uni","BASE_URL"],"mappings":";;;;AAYA,SAAS,YAAY,UAAU;AAC7B,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtCA,kBAAAA,MAAI,WAAW;AAAA,MACb,KAAKC,cAAQ,WAAG;AAAA,MAChB;AAAA,MACA,MAAM;AAAA,MACN,QAAQ;AAAA,QACN,iBAAiB,aAAaD,cAAG,MAAC,eAAe,OAAO,KAAK;AAAA,MAC9D;AAAA,MACD,SAAS,CAAC,QAAQ;AAChB,YAAI;AACF,gBAAM,OAAO,KAAK,MAAM,IAAI,IAAI;AAChC,cAAI,KAAK,SAAS,GAAG;AACnB,oBAAQ,KAAK,KAAK,GAAG;AAAA,UACjC,OAAiB;AACL,mBAAO,IAAI,MAAM,KAAK,OAAO,MAAM,CAAC;AAAA,UACrC;AAAA,QACF,SAAQ,GAAG;AACV,iBAAO,IAAI,MAAM,QAAQ,CAAC;AAAA,QAC3B;AAAA,MACF;AAAA,MACD,MAAM,CAAC,QAAQ;AACb,eAAO,GAAG;AAAA,MACX;AAAA,IACP,CAAK;AAAA,EACL,CAAG;AACH;AAOA,eAAe,aAAa,WAAW;AACrC,QAAM,iBAAiB,UAAU,IAAI,UAAQ,YAAY,IAAI,CAAC;AAC9D,MAAI;AACF,UAAM,OAAO,MAAM,QAAQ,IAAI,cAAc;AAC7C,WAAO;AAAA,EACR,SAAQ,OAAO;AACdA,kBAAA,MAAA,MAAA,SAAA,yBAAc,UAAU,KAAK;AAC7B,UAAM;AAAA,EACP;AACH;AAEA,MAAe,SAAA;AAAA,EACb;AAAA,EACA;AACF;;"}