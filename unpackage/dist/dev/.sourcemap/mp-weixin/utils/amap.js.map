{"version":3,"file":"amap.js","sources":["utils/amap.js"],"sourcesContent":["/**\n * 高德地图相关工具\n * 支持逆地理编码、POI 搜索等\n */\n\nconst ENV = typeof process !== 'undefined' && process.env ? process.env : {};\nconst AMAP_KEY = ENV.UNI_APP_AMAP_KEY || '026ac7e86aa913cb33597b239a2928df';\nconst AMAP_BASE_URL = 'https://restapi.amap.com/v3';\n\nconst requestAmap = (path, params = {}) => {\n\treturn new Promise((resolve, reject) => {\n\t\tif (!AMAP_KEY) {\n\t\t\treject(new Error('未配置 UNI_APP_AMAP_KEY'));\n\t\t\treturn;\n\t\t}\n\t\t\n\t\t// #ifdef MP-WEIXIN\n\t\t// 微信小程序环境提示\n\t\tconsole.warn('微信小程序使用高德API需在后台配置合法域名：https://restapi.amap.com');\n\t\t// #endif\n\t\t\n\t\tuni.request({\n\t\t\turl: `${AMAP_BASE_URL}/${path}`,\n\t\t\tmethod: 'GET',\n\t\t\tdata: {\n\t\t\t\tkey: AMAP_KEY,\n\t\t\t\t...params\n\t\t\t},\n\t\t\tsuccess: ({ statusCode, data }) => {\n\t\t\t\tif (statusCode === 200 && data && data.status === '1') {\n\t\t\t\t\tresolve(data);\n\t\t\t\t} else {\n\t\t\t\t\tlet msg = data && data.info ? data.info : '高德服务请求失败';\n\t\t\t\t\t\n\t\t\t\t\t// 处理特定的错误码\n\t\t\t\t\tif (data && data.info) {\n\t\t\t\t\t\tif (data.info.includes('USERKEY_PLAT_NOMATCH')) {\n\t\t\t\t\t\t\t// #ifdef MP-WEIXIN\n\t\t\t\t\t\t\tmsg = 'API Key平台不匹配，请检查：1.确保使用的是Web服务类型的Key；2.在微信小程序后台配置request合法域名：https://restapi.amap.com';\n\t\t\t\t\t\t\t// #endif\n\t\t\t\t\t\t\t// #ifndef MP-WEIXIN\n\t\t\t\t\t\t\tmsg = 'API Key平台不匹配，请确保使用的是Web服务类型的Key';\n\t\t\t\t\t\t\t// #endif\n\t\t\t\t\t\t} else if (data.info.includes('INVALID_USER_KEY')) {\n\t\t\t\t\t\t\tmsg = 'API Key无效，请检查配置';\n\t\t\t\t\t\t} else if (data.info.includes('DAILY_QUERY_OVER_LIMIT')) {\n\t\t\t\t\t\t\tmsg = 'API调用次数超限';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treject(new Error(msg));\n\t\t\t\t}\n\t\t\t},\n\t\t\tfail: (err) => {\n\t\t\t\t// #ifdef MP-WEIXIN\n\t\t\t\t// 如果是网络错误，可能是域名未配置\n\t\t\t\tif (err.errMsg && err.errMsg.includes('request:fail')) {\n\t\t\t\t\treject(new Error('请求失败，请在微信小程序后台配置request合法域名：https://restapi.amap.com'));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// #endif\n\t\t\t\treject(err);\n\t\t\t}\n\t\t});\n\t});\n};\n\nexport const reverseGeocode = async (lng, lat) => {\n\tconst data = await requestAmap('geocode/regeo', {\n\t\tlocation: `${lng},${lat}`,\n\t\textensions: 'all',\n\t\tradius: 1000,\n\t\troadlevel: 1\n\t});\n\t\n\treturn {\n\t\taddress: data?.regeocode?.formatted_address || '',\n\t\tpois: data?.regeocode?.pois || [],\n\t\traw: data\n\t};\n};\n\nexport default {\n\treverseGeocode\n};\n\n\n"],"names":["uni"],"mappings":";;AAKA,MAAM,MAAM,OAAO,YAAY,eAAe,QAAQ,MAAM,QAAQ,MAAM;AAC1E,MAAM,WAAW,IAAI,oBAAoB;AACzC,MAAM,gBAAgB;AAEtB,MAAM,cAAc,CAAC,MAAM,SAAS,OAAO;AAC1C,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACvC,QAAI,CAAC,UAAU;AACd,aAAO,IAAI,MAAM,sBAAsB,CAAC;AACxC;AAAA,IACA;AAIDA,kBAAAA,MAAa,MAAA,QAAA,uBAAA,iDAAiD;AAG9DA,kBAAAA,MAAI,QAAQ;AAAA,MACX,KAAK,GAAG,aAAa,IAAI,IAAI;AAAA,MAC7B,QAAQ;AAAA,MACR,MAAM;AAAA,QACL,KAAK;AAAA,QACL,GAAG;AAAA,MACH;AAAA,MACD,SAAS,CAAC,EAAE,YAAY,WAAW;AAClC,YAAI,eAAe,OAAO,QAAQ,KAAK,WAAW,KAAK;AACtD,kBAAQ,IAAI;AAAA,QACjB,OAAW;AACN,cAAI,MAAM,QAAQ,KAAK,OAAO,KAAK,OAAO;AAG1C,cAAI,QAAQ,KAAK,MAAM;AACtB,gBAAI,KAAK,KAAK,SAAS,sBAAsB,GAAG;AAE/C,oBAAM;AAAA,YAKN,WAAU,KAAK,KAAK,SAAS,kBAAkB,GAAG;AAClD,oBAAM;AAAA,YACN,WAAU,KAAK,KAAK,SAAS,wBAAwB,GAAG;AACxD,oBAAM;AAAA,YACN;AAAA,UACD;AAED,iBAAO,IAAI,MAAM,GAAG,CAAC;AAAA,QACrB;AAAA,MACD;AAAA,MACD,MAAM,CAAC,QAAQ;AAGd,YAAI,IAAI,UAAU,IAAI,OAAO,SAAS,cAAc,GAAG;AACtD,iBAAO,IAAI,MAAM,sDAAsD,CAAC;AACxE;AAAA,QACA;AAED,eAAO,GAAG;AAAA,MACV;AAAA,IACJ,CAAG;AAAA,EACH,CAAE;AACF;AAEY,MAAC,iBAAiB,OAAO,KAAK,QAAQ;;AACjD,QAAM,OAAO,MAAM,YAAY,iBAAiB;AAAA,IAC/C,UAAU,GAAG,GAAG,IAAI,GAAG;AAAA,IACvB,YAAY;AAAA,IACZ,QAAQ;AAAA,IACR,WAAW;AAAA,EACb,CAAE;AAED,SAAO;AAAA,IACN,WAAS,kCAAM,cAAN,mBAAiB,sBAAqB;AAAA,IAC/C,QAAM,kCAAM,cAAN,mBAAiB,SAAQ,CAAE;AAAA,IACjC,KAAK;AAAA,EACP;AACA;;"}